<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Phone Store - AliExpress Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            height: 6px;
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .bottom-nav-item {
            @apply flex flex-col items-center justify-center text-gray-500 hover:text-red-600 transition-colors duration-200; /* AliExpress: red hover */
        }
        .bottom-nav-item i {
            @apply text-xl mb-1;
        }
        .bottom-nav-item span {
            @apply text-xs;
        }
        .product-card {
            min-width: 160px;
            width: 45%;
            max-width: 200px;
        }
        @media (min-width: 400px) {
            .product-card {
                width: 40%;
            }
        }
        /* Modal styles */
        .modal {
            @apply fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50 transition-opacity duration-300;
        }
        .modal-content {
            @apply bg-white p-6 rounded-lg shadow-xl w-11/12 max-w-md mx-auto transform transition-all duration-300 scale-95 opacity-0;
        }
        .modal.active .modal-content {
            @apply scale-100 opacity-100;
        }
        .loading-spinner {
            border-top-color: #ef4444; /* AliExpress: red */
            @apply inline-block w-6 h-6 border-4 border-gray-200 border-solid rounded-full animate-spin;
        }

        /* AliExpress Color Palette (Approximate) */
        .aliexpress-red {
            background-color: #ff4747; /* A common AliExpress red/orange */
            color: white;
        }
        .aliexpress-red-text {
            color: #ff4747;
        }
        .aliexpress-red-hover:hover {
            background-color: #e63939; /* Darker shade for hover */
        }
        .aliexpress-secondary-button {
            @apply bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm shadow hover:bg-gray-300 transition-colors flex-shrink-0;
        }
        .aliexpress-active-category {
             @apply aliexpress-red text-white px-4 py-2 rounded-full text-sm shadow flex-shrink-0;
        }

    </style>
</head>
<body class="bg-gray-100" dir="ltr">

    <div class="container mx-auto max-w-md bg-white shadow-lg min-h-screen">

        <!-- Top Navigation Bar -->
        <header class="sticky top-0 z-40 bg-white shadow-md px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <img src="https://placehold.co/30x30/ff4747/ffffff?text=S" alt="Store Logo" class="h-8 w-8 rounded-full"> <!-- AliExpress red logo bg -->
                    <h1 class="text-xl font-semibold text-gray-800">The Phone Store</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button aria-label="Search" class="text-gray-600 hover:text-red-600">
                        <i class="fas fa-search text-xl"></i>
                    </button>
                    <button aria-label="Notifications" class="text-gray-600 hover:text-red-600 relative">
                        <i class="fas fa-bell text-xl"></i>
                        <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white"></span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-4 pb-20">

            <!-- Categories Section -->
            <section class="mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-2">Categories</h2>
                <div class="flex space-x-3 overflow-x-auto pb-2">
                    <button class="aliexpress-active-category">Electronics</button> <!-- Active category with AliExpress red -->
                    <button class="aliexpress-secondary-button">Fashion</button>
                    <button class="aliexpress-secondary-button">Home</button>
                    <button class="aliexpress-secondary-button">Beauty</button>
                    <button class="aliexpress-secondary-button">Sports</button>
                </div>
            </section>

            <!-- Products Section -->
            <section class="mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-3">Products</h2>
                <div id="products-section" class="flex space-x-4 overflow-x-auto pb-3">
                    <!-- Product Card 1 -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 flex-shrink-0">
                        <a href="#" class="block h-full flex flex-col">
                            <img src="https://placehold.co/300x200/e2e8f0/94a3b8?text=Product+1" alt="Smartphone Pro X" class="w-full h-32 object-cover">
                            <div class="p-3 flex flex-col flex-grow">
                                <h3 class="product-name text-sm font-semibold text-gray-800 mb-1 truncate">Smartphone Pro X</h3>
                                <div class="flex items-center justify-between text-xs mb-2">
                                    <p class="font-bold aliexpress-red-text">$599</p> <!-- Price in red -->
                                    <div class="flex items-center text-gray-500">
                                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                                        <span>4.5</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mb-1">454 sold</p>
                                <button class="generate-details-btn mt-1 text-xs aliexpress-red-text hover:text-red-700 self-start">✨ See more details</button> <!-- Button text in red -->
                                <div class="text-right mt-auto">
                                     <i class="fas fa-arrow-right aliexpress-red-text"></i> <!-- Arrow in red -->
                                </div>
                            </div>
                        </a>
                    </div>
                    <!-- Product Card 2 -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 flex-shrink-0">
                         <a href="#" class="block h-full flex flex-col">
                            <img src="https://placehold.co/300x200/dbeafe/60a5fa?text=Product+2" alt="Wireless Headphones" class="w-full h-32 object-cover">
                            <div class="p-3 flex flex-col flex-grow">
                                <h3 class="product-name text-sm font-semibold text-gray-800 mb-1 truncate">Wireless Headphones</h3>
                                <div class="flex items-center justify-between text-xs mb-2">
                                    <p class="font-bold aliexpress-red-text">$129</p> <!-- Price in red -->
                                    <div class="flex items-center text-gray-500">
                                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                                        <span>4.8</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mb-1">1020 sold</p>
                                <button class="generate-details-btn mt-1 text-xs aliexpress-red-text hover:text-red-700 self-start">✨ See more details</button> <!-- Button text in red -->
                                <div class="text-right mt-auto">
                                     <i class="fas fa-arrow-right aliexpress-red-text"></i> <!-- Arrow in red -->
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

            <!-- Recommended for You Section -->
            <section class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-lg font-semibold text-gray-700">Recommended for You</h2>
                    <button id="get-more-recommendations-btn" class="text-sm bg-red-100 aliexpress-red-text px-3 py-1 rounded-full hover:bg-red-200 transition-colors">✨ Get more recommendations</button> <!-- Button with red theme -->
                </div>
                <div id="recommended-products-section" class="flex space-x-4 overflow-x-auto pb-3">
                    <!-- Recommended Product 1 -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 flex-shrink-0">
                        <a href="#" class="block h-full flex flex-col">
                            <img src="https://placehold.co/300x200/f0fdfa/2dd4bf?text=Rec+1" alt="Noise Cancelling Earbuds" class="w-full h-32 object-cover">
                            <div class="p-3 flex flex-col flex-grow">
                                <h3 class="product-name text-sm font-semibold text-gray-800 mb-1 truncate">Noise Cancelling Earbuds</h3>
                                <div class="flex items-center justify-between text-xs mb-2">
                                    <p class="font-bold aliexpress-red-text">$159</p> <!-- Price in red -->
                                    <div class="flex items-center text-gray-500">
                                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                                        <span>4.8</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mb-1">800 sold</p>
                                <button class="generate-details-btn mt-1 text-xs aliexpress-red-text hover:text-red-700 self-start">✨ See more details</button> <!-- Button text in red -->
                                <div class="text-right mt-auto">
                                     <i class="fas fa-arrow-right aliexpress-red-text"></i> <!-- Arrow in red -->
                                </div>
                            </div>
                        </a>
                    </div>
                     <!-- Recommended Product 2 -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300 flex-shrink-0">
                         <a href="#" class="block h-full flex flex-col">
                            <img src="https://placehold.co/300x200/fefce8/eab308?text=Rec+2" alt="Portable SSD 1TB" class="w-full h-32 object-cover">
                            <div class="p-3 flex flex-col flex-grow">
                                <h3 class="product-name text-sm font-semibold text-gray-800 mb-1 truncate">Portable SSD 1TB</h3>
                                <div class="flex items-center justify-between text-xs mb-2">
                                    <p class="font-bold aliexpress-red-text">$99</p> <!-- Price in red -->
                                    <div class="flex items-center text-gray-500">
                                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                                        <span>4.7</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mb-1">550 sold</p>
                                <button class="generate-details-btn mt-1 text-xs aliexpress-red-text hover:text-red-700 self-start">✨ See more details</button> <!-- Button text in red -->
                                <div class="text-right mt-auto">
                                     <i class="fas fa-arrow-right aliexpress-red-text"></i> <!-- Arrow in red -->
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </section>

        </main>

        <!-- Bottom Navigation Bar -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-t border-t border-gray-200 max-w-md mx-auto h-16 flex justify-around items-center z-30">
            <a href="#" class="bottom-nav-item aliexpress-red-text"> <!-- Active item in red -->
                <i class="fas fa-home"></i>
                <span class="text-xs">Home</span>
            </a>
            <a href="#" class="bottom-nav-item">
                <i class="fas fa-shopping-cart"></i>
                <span class="text-xs">Cart</span>
            </a>
            <a href="#" class="bottom-nav-item">
                <i class="fas fa-user"></i>
                <span class="text-xs">Profile</span>
            </a>
        </nav>

    </div>

    <!-- Modal for displaying Gemini responses -->
    <div id="gemini-modal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-lg font-semibold text-gray-800">Additional Details</h3>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="modal-body" class="text-sm text-gray-700 leading-relaxed">
                <div class="flex justify-center items-center h-20">
                    <div class="loading-spinner"></div> <!-- Spinner will use red from style -->
                </div>
            </div>
            <div class="mt-6 text-right">
                <button id="modal-ok-btn" class="aliexpress-red aliexpress-red-hover px-4 py-2 rounded-md transition-colors">OK</button> <!-- OK button with AliExpress red -->
            </div>
        </div>
    </div>

<script>
    // Modal elements
    const geminiModal = document.getElementById('gemini-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const modalOkBtn = document.getElementById('modal-ok-btn');
    const modalTitle = document.getElementById('modal-title');
    const modalBody = document.getElementById('modal-body');

    // API Configuration
    const apiKey = ""; // Canvas will provide this
    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

    function showModal(title = "Additional Details", isLoading = true, content = "") {
        modalTitle.textContent = title;
        if (isLoading) {
            modalBody.innerHTML = `<div class="flex justify-center items-center h-20"><div class="loading-spinner"></div></div> <p class="text-center text-gray-500 mt-2">Fetching information...</p>`;
        } else {
            modalBody.innerHTML = content.replace(/\n/g, '<br>');
        }
        geminiModal.classList.remove('hidden');
        geminiModal.classList.add('active');
    }

    function hideModal() {
        geminiModal.classList.add('hidden');
        geminiModal.classList.remove('active');
    }

    closeModalBtn.addEventListener('click', hideModal);
    modalOkBtn.addEventListener('click', hideModal);
    geminiModal.addEventListener('click', (event) => {
        if (event.target === geminiModal) {
            hideModal();
        }
    });

    async function callGeminiAPI(prompt) {
        const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }]
        };
        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                const errorData = await response.json();
                console.error("Gemini API Error:", errorData);
                throw new Error(`API request failed with status ${response.status}: ${errorData.error?.message || 'Unknown error'}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 &&
                result.candidates[0].content && result.candidates[0].content.parts &&
                result.candidates[0].content.parts.length > 0) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                throw new Error("Could not retrieve information from Gemini.");
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return `An error occurred: ${error.message}. Please try again later.`;
        }
    }

    document.querySelectorAll('.generate-details-btn').forEach(button => {
        button.addEventListener('click', async (event) => {
            event.preventDefault();
            event.stopPropagation();

            const card = event.target.closest('.product-card');
            const productNameElement = card.querySelector('.product-name');
            if (!productNameElement) {
                console.error("Product name element not found in card:", card);
                showModal("Error", false, "Could not find the product name.");
                return;
            }
            const productName = productNameElement.textContent.trim();
            
            showModal(`Details for "${productName}"`);

            const prompt = `Generate an engaging and concise product description in English for a product named "${productName}". This product is sold on an e-commerce app. Highlight its key features and benefits for a potential buyer. Keep it under 80 words. Start with the product name.`;
            
            const description = await callGeminiAPI(prompt);
            showModal(`Details for "${productName}"`, false, description);
        });
    });

    const getMoreRecommendationsBtn = document.getElementById('get-more-recommendations-btn');
    if (getMoreRecommendationsBtn) {
        getMoreRecommendationsBtn.addEventListener('click', async () => {
            const recommendedSection = document.getElementById('recommended-products-section');
            const currentProducts = Array.from(recommendedSection.querySelectorAll('.product-name'))
                                        .map(el => el.textContent.trim())
                                        .slice(0, 3);

            if (currentProducts.length === 0) {
                showModal("Additional Recommendations", false, "No current products to base recommendations on.");
                return;
            }

            showModal("Additional Recommendations");

            const prompt = `Based on these electronics and accessories: "${currentProducts.join('", "')}", suggest 3 more distinct product names that a user might also be interested in for an e-commerce app. Provide only the product names, each on a new line. For example: Smart Thermostat\nWireless Charger\nVR Headset. Respond in English as product names are usually in English.`;
            
            const recommendationsText = await callGeminiAPI(prompt);
            
            let recommendationsHtml = recommendationsText;
            if (typeof recommendationsText === 'string') {
                const newRecs = recommendationsText.split('\n').filter(rec => rec.trim() !== '');
                if (newRecs.length > 0) {
                    recommendationsHtml = "<strong>New Suggested Products:</strong><ul class='list-disc list-inside mt-2'>";
                    newRecs.forEach(rec => {
                        recommendationsHtml += `<li>${rec.trim()}</li>`;
                    });
                    recommendationsHtml += "</ul>";
                } else {
                    recommendationsHtml = "Could not find new recommendations at this time. Please try again.";
                }
            }
            
            showModal("Additional Recommendations", false, recommendationsHtml);
        });
    }

    console.log("The Phone Store initialized with Gemini features and AliExpress color theme.");

</script>

</body>
</html>
